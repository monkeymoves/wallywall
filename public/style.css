/* === CSS Variables (Theming) === */
:root {
  --bg-main: #333333;
  --bg-panel: #3a3a3a;
  --bg-header: #424242;
  --bg-input: #383838;

  --text-primary: #e0e0e0;
  --text-secondary: #a0a0a0;
  --text-placeholder: #6b7280;

  --accent-primary: #3b82f6;
  --accent-hover: #2563eb;
  --accent-disabled: #4b5563;

  --border-color: #4f5864;
  --border-focus: var(--accent-primary);

  --start-c: #4ade80; /* start */
  --hold-c: #facc15;  /* move */
  --finish-c: #c084fc;/* finish */
  --delete-c: #ef4444;

  --radius-sm: 4px;
  --radius-md: 8px;
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

/* === Base & Typography === */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  background-color: var(--bg-main);
  color: var(--text-primary);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100vh;
  padding-top: 60px;
}
h2, h3, h4 { color: var(--text-primary); font-weight: 500; margin-bottom: 0.75rem; }
p { color: var(--text-secondary); line-height: 1.5; }

/* === Layout === */
.hdr {
  background-color: var(--bg-header);
  border-bottom: 1px solid var(--border-color);
  height: 60px;
  padding: 0 2rem 0 1rem;
  display: flex; align-items: center; gap: 0.75rem;
  flex-shrink: 0; position: fixed; top: 0; left: 0; right: 0; z-index: 101;
}
.board-main {
  flex-grow: 1; display: flex; flex-direction: column;
  justify-content: flex-start; align-items: center;
  overflow: auto; padding: 1rem;
}
.board-container { position: relative; max-width: 100%; max-height: 100%; }

#currentBoard {
  display: block; max-width: 100%; max-height: 100%;
  object-fit: contain; border-radius: var(--radius-md);
}

/* Canvas overlay where markers are drawn */
#overlayCanvas {
  position: absolute; top: 0; left: 0;
  pointer-events: none;   /* clicks go to underlying image unless in edit mode */
  z-index: 2;             /* keep markers above the photo */
}

/* === Buttons === */
.btn, button {
  font-family: inherit; font-size: 0.875rem; font-weight: 500;
  padding: 0.5rem 1rem; border-radius: var(--radius-md);
  border: 1px solid var(--border-color); background-color: var(--bg-panel);
  color: var(--text-primary); cursor: pointer; transition: background-color 0.2s, border-color 0.2s;
}
.btn:hover, button:hover { background-color: #2a2a2a; border-color: #4b5563; }
button.primary { background-color: var(--accent-primary); border-color: var(--accent-primary); color: #fff; }
button.primary:hover { background-color: var(--accent-hover); border-color: var(--accent-hover); }
button:disabled { background-color: var(--accent-disabled); border-color: var(--accent-disabled); color: var(--text-secondary); cursor: not-allowed; }

.hdr-btn {
  background: transparent; border: none; font-size: 1.25rem; padding: 0.5rem;
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
}
.hdr-btn:hover { background-color: rgba(255, 255, 255, 0.1); }

.file-upload-input { display: none; }

/* === Forms & Inputs === */
input, select, textarea {
  font-family: inherit; font-size: 0.875rem; width: 100%;
  padding: 0.65rem 0.75rem; background-color: var(--bg-input);
  border: 1px solid var(--border-color); border-radius: var(--radius-md); color: var(--text-primary);
  transition: border-color 0.2s, box-shadow 0.2s;
}
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--border-focus); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); }
select {
  -webkit-appearance: none; -moz-appearance: none; appearance: none;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem;
}
textarea { min-height: 80px; resize: vertical; }

/* === Header Controls === */
.hdr-title { font-size: 1.25rem; font-weight: 700; color: var(--text-primary); margin-right: auto; }
.problem-select { min-width: 200px; }
.draw-toolbar { display: flex; align-items: center; background-color: var(--bg-input); border-radius: var(--radius-md); padding: 4px; }
.hold-btn { padding: 0.3rem 0.8rem; border: none; background: transparent; color: var(--text-secondary); }
.hold-btn.active { background-color: var(--bg-panel); color: var(--text-primary); box-shadow: var(--shadow-md); }
.hold-btn[data-type="start"].active { color: var(--start-c); }
.hold-btn[data-type="hold"].active  { color: var(--hold-c); }
.hold-btn[data-type="finish"].active{ color: var(--finish-c); }
.hold-btn[data-type="delete"].active{ color: var(--delete-c); }

/* === Sidebar, Bottom sheet, Utilities, Problem info === */
.boards-panel { position: fixed; top: 60px; bottom: 0; left: 0; width: 280px;
  background-color: var(--bg-panel); border-right: 1px solid var(--border-color);
  padding: 1.5rem 1rem; display: flex; flex-direction: column; gap: 1.5rem;
  overflow-y: auto; transform: translateX(-100%); transition: transform 0.3s ease-in-out; z-index: 100;
}
.boards-panel.open { transform: translateX(0); box-shadow: var(--shadow-lg); }
.sidebar-section { display: flex; flex-direction: column; gap: 1rem; }
.sidebar-section h3, .sidebar-section h4 { margin-bottom: 0; }
.sidebar-section h3 { font-weight: 700; }
#account-title{ color: var(--start-c); } #boards-title{ color: var(--hold-c); } #board-owner-title{ color: var(--finish-c); }
#authPanel h3 { font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); word-break: break-word; }
.auth-panel, .board-panel, .owner-controls-group { display:flex; flex-direction:column; gap:0.75rem; }
#upload-controls { display:flex; flex-direction:column; gap:0.75rem; }
.boards-panel ul { padding:0; margin:0; list-style:none; display:flex; flex-direction:column; gap:0.5rem; }
#ownedBoardsList li, #sharedBoardsList li { padding:0.75rem 1rem; border-radius:var(--radius-md); cursor:pointer; transition:background-color 0.2s, color 0.2s; color:var(--text-secondary); }
#ownedBoardsList li { color: var(--hold-c); }
#ownedBoardsList li:hover, #sharedBoardsList li:hover { background-color: rgba(255,255,255,0.05); color: var(--text-primary); }
#shared-users-list li { display:flex; justify-content:space-between; align-items:center; padding:0.5rem 1rem; border-radius:var(--radius-md); background-color: rgba(59,130,246,0.15); color:var(--text-primary); font-size:0.875rem; }
#shared-users-list li button { padding:0.25rem 0.5rem; font-size:0.75rem; margin-left:0.5rem; }
.sheet { position:fixed; bottom:0; left:0; right:0; background-color:var(--bg-panel); border-top:1px solid var(--border-color);
  border-top-left-radius:16px; border-top-right-radius:16px; padding:1rem 1.5rem 1.5rem; transform:translateY(100%);
  transition: transform 0.3s ease-in-out; z-index:110; box-shadow:0 -5px 20px rgba(0,0,0,0.2);
}
.sheet.visible{ transform: translateY(0); }
.sheet-handle{ width:40px; height:4px; background-color:var(--border-color); border-radius:2px; margin:0 auto 1.5rem; }
.sheet-body{ display:flex; flex-direction:column; gap:1rem; }
.sheet-actions{ display:flex; justify-content:flex-end; gap:0.75rem; margin-top:0.5rem; }
.hidden{ display:none !important; }
.problem-info-card{
  margin-top:1rem; padding:1rem 1.5rem; background-color:var(--bg-panel); border-radius:var(--radius-md);
  width:100%; max-width:900px; display:flex; flex-direction:row; align-items:flex-start; gap:1.5rem; border:1px solid var(--border-color);
}
.problem-grade-badge{ font-weight:700; color:var(--accent-primary); background-color:rgba(59,130,246,0.15); padding:0.25rem 0.75rem; border-radius:9999px; line-height:1.5; white-space:nowrap; }
#problemDescriptionText{ white-space:pre-wrap; color:var(--text-secondary); line-height:1.6; }

@media (max-width: 640px){
  .hdr{ padding:0 0.5rem; gap:0.25rem; }
  .problem-select{ min-width:130px; font-size:0.8rem; }
  .hdr-title{ font-size:1.1rem; }
  .hdr-btn{ padding:0.4rem; width:36px; height:36px; }
  .problem-info-card{ flex-direction:column; align-items:flex-start; gap:0.75rem; padding:1rem; }
}